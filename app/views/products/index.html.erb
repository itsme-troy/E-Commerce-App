<div class="products-page">

  <!-- Sidebar Filter -->
  <aside class="sidebar">

    <!-- Product Search
    <%= form_with url: products_path, method: :get, local: true do %>
        <div>
            <label>Search Product</label>
            <%= text_field_tag :query, params[:query], placeholder: "Search product or tags" %>
        </div>
    <% end %>  -->

    <form id="price-form" action="<%= products_path %>" method="get">
        <label> Filter by Price </label>
        <div id="price-slider"></div>

        <!-- Hidden fields for submission -->
        <input type="hidden" name="min_price" id="min-price-input" value="<%= params[:min_price] || 0 %>">
        <input type="hidden" name="max_price" id="max-price-input" value="<%= params[:max_price] || 5000 %>">

        <div style="margin-top: 10px;">
            <span>Price: ₱<span id="min-price-display"></span></span>
            –
            <span>₱<span id="max-price-display"></span></span>
        </div>

    </form>


<%# when user selects category, keeps min and max proce, query, applies selected category  %>  
    <label>Filter by Category</label>
    <div class="category-scroll">     
        <ul class="category-list">
            <% @categories.each do |category| %>
                <li>
                <%= link_to category.name, products_path(
                        category_id: category.id,
                        min_price: params[:min_price],
                        max_price: params[:max_price],
                        query: params[:query]
                    ),
                    class: (params[:category_id].to_i == category.id ? "active" : "") %>
                </li>
            <% end %>
        </ul>
    </div> 

    <div class="reset-button-wrapper">
        <%= link_to "Reset Filters", products_path, class: "btn btn-reset" %>
    </div>

  </aside>


  <!-- Main Content -->
  <div class="main-content">
    <div class="header-container">
      <h1 class="page-title">Products</h1>
      <div class="header-buttons">
        <%= link_to new_product_path, class: "btn btn-success icon-spacing responsive-button" do %>
            <i class="fas fa-plus"></i>
            <span class="button-text">New</span>
        <% end %>

       
        <%= form_with url: products_path, method: :get, local: true, class: "search-form" do %>
          <div class="search-wrapper">
            <%= text_field_tag :query, params[:query], placeholder: "Search product or tags", class: "search-input" %>
            <button type="submit" class="search-icon-btn">
              <i class="fas fa-search"></i>
            </button>
          </div>
        <% end %>
      </div> 
    </div>

    <!-- Product Table -->
    <table class="table table-hover table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
        <% if @products.any? %> 
            <% @products.each_with_index do |product, index| %>
            <tr onclick="window.location='<%= product_path(product) %>'" style="cursor: pointer;">
                <td class="counter-col"> <%= index + 1 %></td>
                <td><%= product.name %></td>
                <td><%= product.category&.name || "Uncategorized" %></td>
                <td>₱<%= number_with_precision(product.price) if product.price.present? %></td>
            </tr>
            <% end %>
        <% else %> 
            <tr> 
                <td colspan="4" class= "text-center text-muted"> No products found. </td>  
            </tr> 

        <% end %> 

      </tbody>
    </table>
  </div>
</div>
